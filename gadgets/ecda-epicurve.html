<dom-module id="ecda-epicurve">


    <style>
        .outdiv {
            margin: 20px;
        }
    </style>

    <template>

        <iron-ajax id="gadgetRequestAjax"
                   on-response="handleGadgetResponse"></iron-ajax>


        <div class="outdiv">

            <paper-card id="gadgetcard"
                        heading="Gadget {{gadgetJson.gadgetName  }}  "
                        image=""
                        elevation="4 " animated-shadow="true ">

                <paper-toolbar>
                    <paper-icon-button icon="menu"
                                       list-toggle></paper-icon-button>
                </paper-toolbar>

                <div class="card-content ">
                    <google-chart
                            id="chart1"
                            type="stepped-area"
                            data={{responseJson}}
                            options={{chartOptions}}>

                    </google-chart>


                </div>

                <!--    <p>
                        <paper-input label="Top "
                                     value="{{gadgetJson.top }}"></paper-input>
                    </p>

                    <paper-slider min="10 " max="200 "
                                  value="110 "></paper-slider>
                    <paper-input label="Enter text here "></paper-input>
                    <paper-button dialog-confirm autofocus
                                  on-click="_makeEpiCurveRequest">OK
                    </paper-button>
                </div>

-->

                <paper-material>
                    <div>{{gadgetJson.gadgetType }}</div>
                </paper-material>


            </paper-card>

        </div>

    </template>
    <script>


        Polymer({
            is: 'ecda-epicurve',
            properties: {
                gadgetJson: {
                    type: String,
                    value: "Json Here",
                    notify: true,
                    observer: '_validate'
                },
                responseJson: {
                    type: Object
                },
                chartOptions: {
                    type: Object,
                    value: {
                        hAxis: {title: "default"},
                        vAxis: {title: "Count"},
                        explorer: {
                            maxZoomOut: 2,
                            maxZoomIn: .01,
                            zoomDelta: .1,
                            keepInBounds: true,
                            actions: ['dragToZoom',
                                'rightClickToReset']
                        }
                    }
                }
            },
            ready: function () {

                this.async(function () {
                    this.$.chart1.options.hAxis.title = this.gadgetJson.dateInterval;
                    this._makeEpiCurveRequest();
                });


            }
            ,
            _validate: function () {

                //  ecda.validateSchema('epicurve', this.gadgetJson  )        ;

                if (this.gadgetJson != "Json Here") {
                    logThis("ec sch from o   ---->");
                    console.log(epicurveRequestSchema(this.gadgetJson));
                }

            }
            ,
            handleGadgetResponse: function (response) {

                //  walk(JSON.parse(response.detail.xhr.responseText));
                //  logThis(response.detail.xhr.responseText);

                this.responseJson = JSON.parse(response.detail.xhr.responseText);
                logThis(this.responseJson);
            }
            ,
            _makeEpiCurveRequest: function () {


                /*          logThis("ec sch ---->");
                 console.log(epicurveRequestSchema(this.gadgetJson));
                 */
                var request = {

                    DatasourceName: this.gadgetJson.DatasourceName,
                    dateVariable: this.gadgetJson.dateVariable,
                    xAxisStartValue: this.gadgetJson.xAxisStartValue,
                    xAxisEndValue: this.gadgetJson.xAxisEndValue,
                    dateInterval: this.gadgetJson.dateInterval,
                    caseStatusVariable: this.gadgetJson.caseStatusVariable

                };

                //     walk(this.gadgetJson);

                logThis(request);

                tryAjax(this.$.gadgetRequestAjax, "epicurve", request);

            }
        })
        ;
    </script>


</dom-module>





